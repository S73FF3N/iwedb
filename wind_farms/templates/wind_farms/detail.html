{% extends "polls/base.html" %}
{% load static %}
{% load l10n %}

{% block title %}
    {{ windfarm.name }}
{% endblock %}

{% block content %}
{{ filter.form.media }}
<div class="container">
    <div class="row">
    <div class="col-lg-12">
        <h1>{{ windfarm.name }}</h1>
        <a class="btn btn-primary pull-right" href="{% url "wind_farms:windfarm_edit" windfarm.id  %}"><i class="fa fa-edit"></i> Suggest changes</a>
    </div>
    </div>
</div>
<!-- Map -->
{% if windfarm.amount_turbines = 0 %}
<section id="map" class="container map">
    <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?q={{windfarm.latitude|unlocalize}},{{windfarm.longitude|unlocalize}}&hl=es;z=14&amp;output=embed"></iframe>
    <br />
    <small>
        <a href="https://maps.google.com/maps?q={{windfarm.latitude|unlocalize}},{{windfarm.longitude|unlocalize}}&hl=es;z=14&amp;output=embed"></a>
    </small>
</section>
{% else %}
<div class="container map" id="map" style="width: 100%; height: 400px;"></div>
    <script>
    function initMap() {
        var turbines = {{json_turbines|safe}}
        var infowindows = null;

        var locations = [];
        for (i = 0; i < turbines.length; i++) {
                locations.push([new google.maps.LatLng(turbines[i]["fields"].latitude, turbines[i]["fields"].longitude), '<b>' + '<a href="http://iwedb.tk/turbine/'+turbines[i].pk+'/'+turbines[i]["fields"].slug+'/'+'">'+ turbines[i]["fields"].turbine_id + '</a></br>'])
            };

        infowindow = new google.maps.InfoWindow({
            content: "holding..."
        });

        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: {lat: turbines[0]["fields"].latitude, lng: turbines[0]["fields"].longitude}
        });

        var markers = locations.map(function(location, i) {
            return new google.maps.Marker({
                position: location[0],
                title: location[1]
            });
        });

        for (var i=0; i< markers.length; i++) {
            var marker = markers[i];
            google.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent(this.title);
                infowindow.open(map, this);
            });}

        var markerCluster = new MarkerClusterer(map, markers, {styles: [
        {
            textColor: 'white',
            url: '/static/img/m/m1.png',
            height: 52,
            width: 53
        },
        {
            textColor: 'white',
            url: '/static/img/m/m2.png',
            height: 55,
            width: 56
        },
        {
            textColor: 'white',
            url: '/static/img/m/m3.png',
            height: 65,
            width: 66
        },
        {
            textColor: 'white',
            url: '/static/img/m/m4.png',
            height: 77,
            width: 78
        },
        {
            textColor: 'white',
            url: '/static/img/m/m5.png',
            height: 89,
            width: 90
        }
    ]
        });
    }
    </script>
    <script src="/static/js/markerclusterer.js"></script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBPf2vVr8toXpXJ2TLInDRjWS4cLQ5tzAk &callback=initMap">
    </script>
{% endif %}
<div class="container">
    <div class="col-lg-12">
        <table class="table">
            <colgroup> <col width="80"> <col width="100"> </colgroup>
            <tr>
                <th colspan="3">General</th>
            </tr>
            {% if windfarm.turbines|length > 0 %}<tr>
                <td>Turbines</td>
                <td>{{ windfarm.amount_turbines }}</td>
                <td colspan="2">{% for key, value in windfarm.get_distinct_wec_typ.items %}{{ value.0 }} x <a href="{{ value.2 }}">{{ value.1 }} {{ key }} </a>{% endfor %}</td>
            </tr>{% endif %}
            {% if windfarm.get_turbines_in_production|length > 0 %}<tr>
                <td>in production</td>
                <td colspan="2">{% for t in windfarm.get_turbines_in_production %}<a href="{{ t.get_absolute_url }}">{{ t.turbine_id }} </a>{% endfor %}</td>
            </tr>{% endif %}
            {% if windfarm.get_turbines_planned|length > 0 or windfarm.get_turbines_construction|length > 0 %}<tr>
                <td>planned/under construction</td>
                <td colspan="2">{% for t in windfarm.get_turbines_planned %}<a href="{{ t.get_absolute_url }}">{{ t.turbine_id }} </a>{% endfor %}{% for t in windfarm.get_turbines_construction %}<a href="{{ t.get_absolute_url }}"> {{ t.turbine_id }}</a>{% endfor %}</td>
            </tr>{% endif %}
            {% if windfarm.get_turbines_dismantled|length > 0 %}<tr>
                <td>dismantled</td>
                <td colspan="2">{% for t in windfarm.get_turbines_dismantled %}<a href="{{ t.get_absolute_url }}">{{ t.turbine_id }} </a>{% endfor %}</td>
            </tr>{% endif %}
            {% if windfarm.city or windfarm.country %}<tr>
                <td>Location</td>
                <td colspan="2">{% if windfarm.city %}{{ windfarm.city }}, {% endif %}{% if windfarm.country %}{{ windfarm.country }}{% endif %}</td>
            </tr>
            {% endif %}
            {% if windfarm.offshore %}<tr>
                <td>Offshore</td>
                <td colspan="2">{{ windfarm.offshore }}</td>
            </tr>{% endif %}
            {% if windfarm.description %}<tr>
                <td>Description</td>
                <td colspan="2">{{ windfarm.description }}</td>
            </tr>{% endif %}
            <!--<tr>
                <th colspan="3">Time line</th>
            </tr>-->
        </table>
    </div>
</div>
<!--<div class="container">
    <div class="top">
        {% for t in windfarm.turbines %}{% if t.commisioning %}<div class="top-element"><a href="{{t.get_absolute_url }}">{{ t.turbine_id }}</a><br>Comissioning:<br>{{ t.commisioning }}</div>{% endif %}{% endfor %}
  </div>

    <div class="line"></div>

  <div class="bottom">
      {% for t in windfarm.turbines %}{% if t.dismantling %}<div class="bottom-element">{{ t.turbine_id }}<br>Dismantling:<br>{{ t.dismantling }}</div>{% endif %}{% endfor %}
  </div>
</div>-->
{% endblock %}