{% extends "polls/base.html" %}
{% load static %}
{% load render_table from django_tables2 %}
{% load widget_tweaks %}
{% load i18n %}

{% block title %}
    {% trans "Create Order" %}
{% endblock %}

{% block content %}
<div class="container-fluid">
    <form action="" method="POST" class="create-order-form">
        {% csrf_token %}
        {{ form.media }}
        <h1>{% trans "Create Order" %}</h1>
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.order_no.label_tag }}
                    <div class="input-next-to-select">
                        {% render_field form.order_no class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.recipient.label_tag }}
                    <div class="input-next-to-select">
                        {% render_field form.recipient class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.order_date.label_tag }}
                    <div class="select-with-border">
                        {% render_field form.order_date class="placeholder-right" %}
                    </div>
                </span>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <span>
                    {{ form.ordered_by.label_tag }}
                    <div class="autocomplete-input-with-border-next-input">
                        {% render_field form.ordered_by class="placeholder-right" %}
                    </div>
                </span>
            </div>
        </div>
        <hr/>
        {% trans "Wind farm" %}:
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.wind_farm_desc.label_tag }}
                    {% render_field form.wind_farm_desc class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.wind_farm_wec_count.label_tag }}
                    {% render_field form.wind_farm_wec_count class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.wind_farm_wka.label_tag }}
                    {% render_field form.wind_farm_wka class="placeholder-right" %}
                </span>
            </div>
        </div>
        <hr/>
        {% trans "Event" %}:
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.event_type.label_tag }}
                    <div class="select-with-border">
                        {% render_field form.event_type class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.price.label_tag }}
                    <div class="input-next-to-select">
                        {% render_field form.price class="placeholder-right" %}
                    </div>
                </span>
            </div>
        </div>
        <hr/>
        {% trans "Date Request" %}:
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.date_asap.label_tag }}
                    <div class="select-with-border">
                        {% render_field form.date_asap class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div id="div-date-request" class="col-6 col-lg-4">
                <span>
                    {{ form.date_request.label_tag }}
                    <div class="input-next-to-select">
                        {% render_field form.date_request class="placeholder-right" %}
                    </div>
                </span>
            </div>
        </div>
        <hr/>
        <div class="row">
            <div class="col-6 col-lg-4">
                {% trans "Documents" %}:
            </div>
            <div class="col-6 col-lg-4">
                {% trans "Comment" %}:
            </div>
        </div>
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.documents.label_tag }}
                    {% render_field form.documents class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.customer_manager.label_tag }}
                    {% render_field form.customer_manager class="placeholder-right" %}
                </span>
            </div>
        </div>
        <h1>{% trans "Order confirmation" %}</h1>
        <div class="row">
            <div class="col-3">
                <span>
                    <label for="id-change-order-confirmation"> {% trans "Change Order confirmation" %}</label><br>
                    <div class="autocomplete-input-with-border-next-input">
                        <input type="checkbox" id="id-change-order-confirmation" class="form-control" name="change-order-confirmation">
                    </div>
                </span>
            </div>
        </div>
        <div id="div-change-order-confirmation">
            <div class="row">
                <div class="col-6 col-lg-4">
                    <span>
                        {{ form.order_accepted.label_tag }}
                        <div class="select-with-border">
                            {% render_field form.order_accepted class="placeholder-right" %}
                        </div>
                    </span>
                </div>
                <div class="col-6 col-lg-4">
                    <span>
                        {{ form.planned_execution.label_tag }}
                        <div class="select-with-border">
                            {% render_field form.planned_execution class="placeholder-right" %}
                        </div>
                    </span>
                </div>
                <div class="col-6 col-lg-4">
                    <span>
                        {{ form.name.label_tag }}
                        <div class="input-next-to-select">
                            {% render_field form.name class="placeholder-right" %}
                        </div>
                    </span>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <span>
                        {{ form.confirmation_comment.label_tag }}
                        <div class="select-with-border">
                            {% render_field form.confirmation_comment class="placeholder-right" %}
                        </div>
                    </span>
                </div>
            </div>
        </div>
        <h1>{% trans "Wind farm location information (if available)" %}</h1>
        {% trans "Location" %}:
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.postcode.label_tag }}
                    {% render_field form.postcode class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.location.label_tag }}
                    {% render_field form.location class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.address.label_tag }}
                    {% render_field form.address class="placeholder-right" %}
                </span>
            </div>
        </div>
        <hr/>
        {% trans "WEC(s)" %}:
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.wec_manufacturer.label_tag }}
                    {% render_field form.wec_manufacturer class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.wec_type.label_tag }}
                    {% render_field form.wec_type class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.rotor_blade_type.label_tag }}
                    {% render_field form.rotor_blade_type class="placeholder-right" %}
                </span>
            </div>
        </div>
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.rated_capacity.label_tag }}
                    {% render_field form.rated_capacity class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.hub_height.label_tag }}
                    {% render_field form.hub_height class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.wec_count.label_tag }}
                    {% render_field form.wec_count class="placeholder-right" %}
                </span>
            </div>
        </div>
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.serials.label_tag }}
                    <div class="input-next-to-select">
                        {% render_field form.serials class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.tower_type.label_tag }}
                    <div class="select-with-border">
                        {% render_field form.tower_type class="placeholder-right" %}
                    </div>
                </span>
            </div>
        </div>
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.service_lift.label_tag }}
                    <div class="select-with-border">
                        {% render_field form.service_lift class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div id="div-service-lift-manufacturer" class="col-6 col-lg-4">
                <span>
                    {{ form.service_lift_manufacturer.label_tag }}
                    <div class="input-next-to-select">
                        {% render_field form.service_lift_manufacturer class="placeholder-right" %}
                    </div>
                </span>
            </div>
        </div>
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.winch.label_tag }}
                    {% render_field form.winch class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.bso.label_tag }}
                    {% render_field form.bso class="placeholder-right" %}
                </span>
            </div>
        </div>
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.fall_protection_system.label_tag }}
                    <div class="input-next-to-select">
                        {% render_field form.fall_protection_system class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.local_runner.label_tag }}
                    <div class="select-with-border">
                        {% render_field form.local_runner class="placeholder-right" %}
                    </div>
                </span>
            </div>
        </div>
        <hr/>
        {% trans "Access" %}:
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.contact_person.label_tag }}
                    {% render_field form.contact_person class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.contact_person_tel.label_tag }}
                    {% render_field form.contact_person_tel class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.contact_person_address.label_tag }}
                    {% render_field form.contact_person_address class="placeholder-right" %}
                </span>
            </div>
        </div>
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.key.label_tag }}
                    <div class="input-next-to-select">
                        {% render_field form.key class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.key_code.label_tag }}
                    <div class="input-next-to-select">
                        {% render_field form.key_code class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.alarm_system.label_tag }}
                    <div class="select-with-border">
                        {% render_field form.alarm_system class="placeholder-right" %}
                    </div>
                </span>
            </div>
        </div>
        <hr/>
        {% trans "TBF" %}:
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.company.label_tag }}
                    {% render_field form.company class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.company_contact_person.label_tag }}
                    {% render_field form.company_contact_person class="placeholder-right" %}
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.company_tel.label_tag }}
                    {% render_field form.company_tel class="placeholder-right" %}
                </span>
            </div>
        </div>
        <hr/>
        {% trans "Documents" %}:
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.sp_report.label_tag }}
                    <div class="autocomplete-input-with-border-next-input">
                        {% render_field form.sp_report class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.direction_report.label_tag }}
                    <div class="autocomplete-input-with-border-next-input">
                        {% render_field form.direction_report class="placeholder-right" %}
                    </div>
                </span>
            </div>
        </div>
        <hr/>
        <div class="row">
            <div class="col-12">
                <span>
                    {{ form.miscellaneous.label_tag }}
                    <div class="autocomplete-input-with-border-next-input">
                        {% render_field form.miscellaneous class="placeholder-right" %}
                    </div>
                </span>
            </div>
        </div>
        <div class="row">
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.date.label_tag }}
                    <div class="autocomplete-input-with-border-next-input">
                        {% render_field form.date class="placeholder-right" %}
                    </div>
                </span>
            </div>
            <div class="col-6 col-lg-4">
                <span>
                    {{ form.status.label_tag }}
                    {% render_field form.status class="placeholder-right" %}
                </span>
            </div>
        </div>
        <div>Info: Bitte vor dem Erstellen der Bestellung die Daten noch einmal auf Aktualität prüfen!</div>
        <div class="text-right">
            <input type="submit" id="submit" value="&#xf0da" class="font-awesome">
        </div>
    </form>
</div>
{% endblock %}
{% block javascript %}
    <script type="text/javascript">
    let asap = document.getElementById("id_date_asap");
    asap.addEventListener( 'click', onAsap );
    onAsap()

    let change_order_confirmation = document.getElementById("id-change-order-confirmation");
    change_order_confirmation.addEventListener( 'click', onChangeOrderConfirmation );
    onChangeOrderConfirmation();

    let serviceLift = document.getElementById("id_service_lift");
    serviceLift.addEventListener( 'click', onServiceLift );
    onServiceLift()

    function onAsap( ev ) {
        if (asap.checked){
            let date_request = document.getElementById("div-date-request");
            date_request.style.display = "none";
        }else{
            let date_request = document.getElementById("div-date-request");
            date_request.style.display = "block";
        }
    }

    function onChangeOrderConfirmation( ev ) {
        if (change_order_confirmation.checked){
            let div_change_order_confirmation = document.getElementById("div-change-order-confirmation");
            div_change_order_confirmation.style.display = "block";
        }else{
            let div_change_order_confirmation = document.getElementById("div-change-order-confirmation");
            div_change_order_confirmation.style.display = "none";
        }
    }

    function onServiceLift( ev ) {
        if (serviceLift.checked){
            let service_lift_manufacturer = document.getElementById("div-service-lift-manufacturer");
            service_lift_manufacturer.style.display = "block";
        }else{
            let service_lift_manufacturer = document.getElementById("div-service-lift-manufacturer");
            service_lift_manufacturer.style.display = "none";
        }
    }
    </script>
  <script type="text/javascript">
        var inputs = document.querySelectorAll( 'input[type=text], input[type=email], input[type=number], input[type=select], input[type=tel]' );
        var selects = document.querySelectorAll('select');
        for (i = 0; i < inputs.length; i ++) {
          var inputEl = inputs[i];
          if( inputEl.required ){
            var label = inputEl.parentElement.querySelector( 'label' );
            label.innerHTML = label.innerHTML + " * ";
          }
          if( inputEl.value.trim() !== '' ) {
          	inputEl.parentNode.classList.add( 'inputs--filled' );
          }
          inputEl.addEventListener( 'focus', onFocus );
          inputEl.addEventListener( 'blur', onBlur );
        }
        for (i =0; i < selects.length; i ++) {
            var selectEl = selects[i];
            if( selectEl.required ){
                var label = selectEl.parentElement.parentElement.querySelector( 'label' );
                label.innerHTML = label.innerHTML + " * ";
            }
            if( selectEl.value.trim() !== '' ) {
                selectEl.parentNode.classList.add( 'inputs--filled' );
            }
            selectEl.addEventListener( 'focus', onFocus );
            selectEl.addEventListener( 'blur', onBlur );
        }

        function onFocus( ev ) {
            ev.target.parentNode.classList.add( 'inputs--filled' );
        }

        function onBlur( ev ) {
          if ( ev.target.value.trim() === '' ) {
          	ev.target.parentNode.classList.remove( 'inputs--filled' );
          	ev.target.parentNode.parentNode.classList.remove( 'inputs--filled' );
          } if ( ev.target.checkValidity() == false ) {
            ev.target.parentNode.classList.add( 'inputs--invalid' );
            ev.target.parentNode.parentNode.classList.add( 'inputs--invalid' );
            ev.target.addEventListener( 'input', liveValidation );
            ev.target.addEventListener( 'select', liveValidation );
          } else if ( ev.target.checkValidity() == true ) {
            ev.target.parentNode.classList.remove( 'inputs--invalid' );
            ev.target.parentNode.parentNode.classList.remove( 'inputs--invalid' );
            ev.target.addEventListener( 'input', liveValidation );
            ev.target.addEventListener( 'select', liveValidation );
          }
        }

        function liveValidation( ev ) {
          if ( ev.target.checkValidity() == false ) {
            ev.target.parentNode.classList.add( 'inputs--invalid' );
            ev.target.parentNode.parentNode.classList.add( 'inputs--invalid' );
          } else {
            ev.target.parentNode.classList.remove( 'inputs--invalid' );
            ev.target.parentNode.parentNode.classList.remove( 'inputs--invalid' );
          }
        }

        var submitBtn = document.querySelector( 'input[type=submit]' );
        submitBtn.addEventListener( 'click', onSubmit );

        function onSubmit( ev ) {
          var inputsWrappers = ev.target.parentNode.querySelectorAll( 'span' );
          for (i = 0; i < inputsWrappers.length; i ++) {
            input = inputsWrappers[i].querySelector( 'input[type=text], input[type=email], input[type=number], input[type=select], input[type=tel], input[type=file], select' );
            if ( input.checkValidity() == false ) {
              inputsWrappers[i].classList.add( 'inputs--invalid' );
            } else if ( input.checkValidity() == true ) {
              inputsWrappers[i].classList.remove( 'inputs--invalid' );
            }
            if ( input.type == 'tel' ){
                if( input.value === '' && !input.required){
                    inputsWrappers[i].classList.remove( 'inputs--invalid' );
                }else if (!input.value.match(/^\+?1?\d{1,2}[\W\d]+(\d{1,2})$/)){
                    inputsWrappers[i].classList.add( 'inputs--invalid' );
                    ev.preventDefault()
                }else{
                    inputsWrappers[i].classList.remove( 'inputs--invalid' );
                }
            }
          }
        }
    </script>
{% endblock %}